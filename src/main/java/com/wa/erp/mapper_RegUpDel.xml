<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--***************************************************-->
<!-- mapper 태그 선언하기 -->
<!-- mapper 태그 안의 namespace 값은 -->
<!-- [원하는 인터페이스 저장 패키지 경로]하고 일치해야한다. -->
<!--***************************************************-->
<mapper namespace="com.wa.erp.RegUpDelDAO">
	<select id="getBoard" parameterType="com.wa.erp.BoardSearchDTO" resultType="com.wa.erp.BoardDTO">
		select
			b.b_no
			,p.nickname
			,b.subject
			,b.content
			,b.read_count
			,to_char(b.reg_date,'YYYY-MM-DD') as "reg_date"
			<if test="table!='tradeboard'">
			,b.rec_count
			</if>
			<if test="table=='tradeboard'">
			,b.price
			,b.trade_type
			</if>
		from
			person_mem p, ${table} b
		where
			p.p_no = b.p_no	
			and
			b.b_no=#{b_no}
	</select>
	<!-- 게시판 새글쓰기 insert  -->
	<insert id="insertBoard" parameterType="com.wa.erp.BoardDTO">
<!-- 		<if test="table != null and table.length()>0"> -->
	    insert into ${table} (
	        b_no,
	        subject,
	        content,
	        pwd,
	        read_count,
	        reg_date,
	        p_no,
	        <if test="table!='tradeboard'">
	        rec_count
	        </if>
	        <if test="table=='tradeboard'">
	         price
	        , trade_type
	        </if>
	        
	    ) values (
	        (select nvl(max(b_no),0)+1 from ${table}),
	        #{subject},
	        #{content},
	        #{pwd},
	        0,
	        sysdate,
	        1,
	        <if test="table!='tradeboard'">
	        0
	        </if>
	          <if test="table=='tradeboard'">
	         #{price}
	        , #{trade_type}
	        </if>
	    )
<!-- 		</if> -->
	</insert>
	
	<update id="updateBoard" parameterType="com.wa.erp.BoardDTO">
		update
			${table}
		set
			subject = #{subject}
			,content = #{content}
			<if test="table=='tradeboard'">
			,price = #{price}
			</if>
		where
			b_no = #{b_no}
			and
			pwd= #{pwd}
	</update>
	
	<delete id="deleteBoard" parameterType="com.wa.erp.BoardDTO">
		delete from 
			${table}
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</delete>
	
	<select  id="getboardCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">
		select count(*) from ${table} where b_no=#{b_no}
	</select>
	
	<!-- 프리랜서 비밀번호 개수 -->
	<select id="getboardPwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from ${table} where b_no=#{b_no} and pwd=#{pwd}			
	</select>
	
	<!--  프리랜서 등록 (p_no 1임의로 들어가있음 수정)-->
	<insert id="inserttimeShare" parameterType="com.wa.erp.RegUpDelDAO">
	    insert into freelancer(
	        b_no
	        ,p_no
	        ,preferred_work
	        ,start_time
	        ,end_time
	        ,content
	        ,reg_date
	        ,pwd    
	    )values(
	       (select nvl(max(b_no),0)+1 from freelancer)
	        ,3
	        ,#{preferred_work}
	        ,#{start_time}
	        ,#{end_time}
	        ,#{content}
	        ,sysdate
	        ,#{pwd}
	    )
	</insert>
	
	<!-- 프리랜서 상세 -->
	<select id="gettimeShareForUpDel"  resultType="com.wa.erp.BoardDTO">
		select
	        f.b_no
	        ,p.p_no
	        ,p.name
	        ,p.phone
	        ,p.addr
	        ,c.career
	        ,f.pwd
	        ,f.preferred_work
	        ,f.start_time
	        ,f.end_time
	        ,f.content
	        ,to_char(f.reg_date, 'YYYY-MM-DDI')  as "reg_date"
	    from
	    person_mem  p, freelancer f, career c
	    where
	      f.b_no=#{f.b_no}
	    and
	       f.p_no=p.p_no
	     and 
	       f.p_no=c.p_no
	</select>
	
	<select  id="gettimeShareCnt" parameterType="int"  resultType="int">
		select count(*) from freelancer where b_no=#{b_no} 
	</select>
	
	<!-- 프리랜서 비밀번호 개수 -->
	<select id="gettimeSharePwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from freelancer where b_no=#{b_no} and pwd=#{pwd}			
	</select>
	
	<!-- 프리랜서 수정 -->
	<update id="updatetimeShare"  parameterType="com.wa.erp.RegUpDelDAO">
	update 
		freelancer
	set	
		preferred_work   =  #{preferred_work}
		,start_time      =  #{start_time}
		,end_time        =  #{end_time}
		,content		 =  #{content}
	where 
		b_no=#{b_no}
		and
		pwd=#{pwd}	
	</update>
	
	<!--  프리랜서 삭제 -->
	<delete id="deletetimeShare"  parameterType="com.wa.erp.RegUpDelDAO">
		delete from 
			freelancer
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}			
	</delete>
	
	
	
	<!--  부업 등록 삭제 수정 -->
	<!-- 부업 수정 들어갈때 값 들고들어오기 -->
	<select id="getbuupForUpDel" parameterType="int" resultType="com.wa.erp.BoardDTO">
    select
    	b_no 
   		,p.p_no
        ,p.name
		,p.phone
		,p.addr
		,c.career
		,t.pwd
		,t.hope_work
		,t.start_time
        ,t.end_time
        ,t.content
        ,to_char(t.reg_date, 'YYYY-MM-DD HH24:MI')  as "reg_date"

      from person_mem p , part_time t , career c
         where 
       	   t.b_no=#{t.b_no}
         and 
         	t.p_no=p.p_no 
         and
            t.p_no=c.p_no        
	</select>
	<!--  	부업 글 개수   -->
	<select  id="getbuupCnt" parameterType="int"  resultType="int">
		select count(*) from part_time where b_no=#{b_no} 
	</select>
	
<!--     부업 비밀번호 개수  -->
	<select id="getbuupPwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from part_time where b_no=#{b_no} and pwd=#{pwd}			
	</select>	

<!-- 부업 등록 (p_no 1임의로 들어가있음 수정)-->	
	<insert id="insertbuup" parameterType="com.wa.erp.RegUpDelDAO">
	insert into part_time(
	    b_no
		,p_no
	    ,hope_work
	    ,start_time
	    ,end_time
	    ,content
	    ,reg_date
	    ,pwd
	)
	values(
	    (select nvl(max(b_no),0)+1 from part_time)
	    ,1
	    ,#{hope_work}
	    ,#{start_time}
	    ,#{end_time}
	    ,#{content}
	    ,sysdate
	    ,#{pwd}
	)
	</insert>
	
	<update id="updatebuup"  parameterType="com.wa.erp.RegUpDelDAO">
		update 
			part_time
		set	
			hope_work    = #{hope_work}
			,start_time  = #{start_time}
			,end_time    = #{end_time}
			,content     = #{content}
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</update>
	
   
	<update id="updatebuupEmpty" parameterType="com.wa.erp.RegUpDelDAO">
		update 
			part_time
		set	
			content = '삭제됨'
		where 
			b_no = #{b_no}
	</update>
	
		
<!-- 	부업 게시글 삭제  -->
	<delete id="deletebuup"  parameterType="com.wa.erp.RegUpDelDAO">
		delete from 
			part_time
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</delete>
	
	<!-- 기업 리뷰 등록 -->
	<insert id="upReview" parameterType="com.wa.erp.BoardDTO">
	insert into review
			(p_no
			,c_no
			,star
			,content
			,rec_count
			,reg_date
			,r_no)
	values
			(
			1
			,#{c_no}
			,#{star}
			,#{content}
			,0
			,sysdate
			,(select nvl(max(r_no),0)+1 from review)
			)
	
	</insert>
</mapper>
 