<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--***************************************************-->
<!-- mapper 태그 선언하기 -->
<!-- mapper 태그 안의 namespace 값은 -->
<!-- [원하는 인터페이스 저장 패키지 경로]하고 일치해야한다. -->
<!--***************************************************-->
<mapper namespace="com.wa.erp.RegUpDelDAO">
	<select id="getBoard" parameterType="com.wa.erp.BoardSearchDTO" resultType="com.wa.erp.BoardDTO">
		select
			b.b_no
			,p.nickname
			,b.subject
			,b.content
			,b.read_count
			,to_char(b.reg_date,'YYYY-MM-DD') as "reg_date"
			<if test="table!='tradeboard'">
			,b.rec_count
			</if>
			<if test="table=='tradeboard'">
			,b.price
			,b.trade_type
			</if>
		from
			person_mem p, ${table} b
		where
			p.p_no = b.p_no	
			and
			b.b_no=#{b_no}
	</select>
	<!-- 게시판 새글쓰기 insert  -->
	<insert id="insertBoard" parameterType="com.wa.erp.BoardDTO">
<!-- 		<if test="table != null and table.length()>0"> -->
	    insert into ${table} (
	        b_no,
	        subject,
	        content,
	        pwd,
	        read_count,
	        reg_date,
	        p_no,
	        <if test="table!='tradeboard'">
	        rec_count
	        </if>
	        <if test="table=='tradeboard'">
	         price
	        , trade_type
	        </if>
	        
	    ) values (
	        (select nvl(max(b_no),0)+1 from ${table}),
	        #{subject},
	        #{content},
	        #{pwd},
	        0,
	        sysdate,
	        #{p_no},
	        <if test="table!='tradeboard'">
	        0
	        </if>
	          <if test="table=='tradeboard'">
	         #{price}
	        , #{trade_type}
	        </if>
	    )
<!-- 		</if> -->
	</insert>
	
	<update id="updateBoard" parameterType="com.wa.erp.BoardDTO">
		update
			${table}
		set
			subject = #{subject}
			,content = #{content}
			<if test="table=='tradeboard'">
			,price = #{price}
			</if>
		where
			p_no =#{p_no}
			and
			b_no = #{b_no}
			and
			pwd= #{pwd}
	</update>
	
	<delete id="deleteBoard" parameterType="com.wa.erp.BoardDTO">
		delete from 
			${table}
		where 
			p_no=#{p_no}
			and
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</delete>
	
	<select  id="getboardCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">
		select count(*) from ${table} where b_no=#{b_no}
	</select>
	
	<!-- 프리랜서 비밀번호 개수 -->
	<select id="getboardPwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from ${table} where b_no=#{b_no} and pwd=#{pwd}			
	</select>
	
	<!--  프리랜서 등록 (p_no 1임의로 들어가있음 수정)-->
	<insert id="inserttimeShare" parameterType="com.wa.erp.RegUpDelDAO">
	    insert into freelancer(
	        b_no
	        ,p_no
	        ,preferred_work
	        ,start_time
	        ,end_time
	        ,content
	        ,reg_date
	        ,pwd    
	    )values(
	       (select nvl(max(b_no),0)+1 from freelancer)
	        ,3
	        ,#{preferred_work}
	        ,#{start_time}
	        ,#{end_time}
	        ,#{content}
	        ,sysdate
	        ,#{pwd}
	    )
	</insert>
	
	<!-- 프리랜서 상세 -->
	<select id="gettimeShareForUpDel"  resultType="com.wa.erp.BoardDTO">
		select
	        f.b_no
	        ,p.p_no
	        ,p.name
	        ,p.phone
	        ,p.addr
	        ,c.career
	        ,f.pwd
	        ,f.preferred_work
	        ,f.start_time
	        ,f.end_time
	        ,f.content
	        ,to_char(f.reg_date, 'YYYY-MM-DDI')  as "reg_date"
	    from
	    person_mem  p, freelancer f, career c
	    where
	      f.b_no=#{f.b_no}
	    and
	       f.p_no=p.p_no
	     and 
	       f.p_no=c.p_no
	</select>
	
	<select  id="gettimeShareCnt" parameterType="int"  resultType="int">
		select count(*) from freelancer where b_no=#{b_no} 
	</select>
	
	<!-- 프리랜서 비밀번호 개수 -->
	<select id="gettimeSharePwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from freelancer where b_no=#{b_no} and pwd=#{pwd}			
	</select>
	
	<!-- 프리랜서 수정 -->
	<update id="updatetimeShare"  parameterType="com.wa.erp.RegUpDelDAO">
	update 
		freelancer
	set	
		preferred_work   =  #{preferred_work}
		,start_time      =  #{start_time}
		,end_time        =  #{end_time}
		,content		 =  #{content}
	where 
		b_no=#{b_no}
		and
		pwd=#{pwd}	
	</update>
	
	<!--  프리랜서 삭제 -->
	<delete id="deletetimeShare"  parameterType="com.wa.erp.RegUpDelDAO">
		delete from 
			freelancer
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}			
	</delete>
	
	
	
	<!--  부업 등록 삭제 수정 -->
	<!-- 부업 수정 들어갈때 값 들고들어오기 -->
	<select id="getbuupForUpDel" parameterType="int" resultType="com.wa.erp.BoardDTO">
    select
    	b_no 
   		,p.p_no
        ,p.name
		,p.phone
		,p.addr
		,c.career
		,t.pwd
		,t.hope_work
		,t.start_time
        ,t.end_time
        ,t.content
        ,to_char(t.reg_date, 'YYYY-MM-DD HH24:MI')  as "reg_date"

      from person_mem p , part_time t , career c
         where 
       	   t.b_no=#{t.b_no}
         and 
         	t.p_no=p.p_no 
         and
            t.p_no=c.p_no        
	</select>
	<!--  	부업 글 개수   -->
	<select  id="getbuupCnt" parameterType="int"  resultType="int">
		select count(*) from part_time where b_no=#{b_no} 
	</select>
	
<!--     부업 비밀번호 개수  -->
	<select id="getbuupPwdCnt" parameterType="com.wa.erp.BoardDTO"  resultType="int">	
		select count(*) from part_time where b_no=#{b_no} and pwd=#{pwd}			
	</select>	

<!-- 부업 등록 (p_no 1임의로 들어가있음 수정)-->	
	<insert id="insertbuup" parameterType="com.wa.erp.RegUpDelDAO">
	insert into part_time(
	    b_no
		,p_no
	    ,hope_work
	    ,start_time
	    ,end_time
	    ,content
	    ,reg_date
	    ,pwd
	)
	values(
	    (select nvl(max(b_no),0)+1 from part_time)
	    ,1
	    ,#{hope_work}
	    ,#{start_time}
	    ,#{end_time}
	    ,#{content}
	    ,sysdate
	    ,#{pwd}
	)
	</insert>
	
	<update id="updatebuup"  parameterType="com.wa.erp.RegUpDelDAO">
		update 
			part_time
		set	
			hope_work    = #{hope_work}
			,start_time  = #{start_time}
			,end_time    = #{end_time}
			,content     = #{content}
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</update>
	
   
	<update id="updatebuupEmpty" parameterType="com.wa.erp.RegUpDelDAO">
		update 
			part_time
		set	
			content = '삭제됨'
		where 
			b_no = #{b_no}
	</update>
	
		
<!-- 	부업 게시글 삭제  -->
	<delete id="deletebuup"  parameterType="com.wa.erp.RegUpDelDAO">
		delete from 
			part_time
		where 
			b_no=#{b_no}
			and
			pwd=#{pwd}	
	</delete>
	
	<!-- 기업 리뷰 등록 -->
	<insert id="upReview" parameterType="com.wa.erp.BoardDTO">
	insert into review
			(p_no
			,c_no
			,star
			,content
			,rec_count
			,reg_date
			,r_no)
	values
			(
			1
			,#{c_no}
			,#{star}
			,#{content}
			,0
			,sysdate
			,(select nvl(max(r_no),0)+1 from review)
			)
	</insert>
	
	 <!-- 이력서 -->
    <insert id="insertResume" parameterType="com.wa.erp.BoardDTO" useGeneratedKeys="true" keyProperty="resume_no">
	    <selectKey keyProperty="resume_no" resultType="int" order="BEFORE">
	        SELECT NVL(MAX(resume_no), 0) + 1 FROM resume
	    </selectKey>
        insert into resume(
           resume_no
            ,p_no
            ,married
            ,military
            ,introduce
            ,is_offer
            ,hope_salary 
        ) values (
         	#{resume_no}          
             ,5
             ,#{married}
            ,#{military}
            ,#{introduce}
            ,#{is_offer}
            ,#{hope_salary}
        )
    </insert>

    <!-- 수상경력 -->
    <insert id="insertAwards" parameterType="com.wa.erp.BoardDTO" >
        insert into awards(
        resume_no
            
            ,name1
            ,organizer1
            ,type1
            ,award_no1
             <if test="name2 != null and name2 != ''">
              ,name2
                 </if>
                  <if test="organizer2 != null and organizer2 != ''">
              ,organizer2
                 </if>
                  <if test="type2 != null and type2 != ''">
              ,type2
                 </if>
                 ,award_no2
                 
                  <if test="name3 != null and name3 != ''">
              ,name3
                 </if>
                  <if test="organizer3 != null and organizer3 != ''">
              ,organizer3
                 </if>
                  <if test="type3 != null and type3 != ''">
              ,type3
                 </if>
                 ,award_no3
                 
                  <if test="name4 != null and name4 != ''">
              ,name4
                 </if>
                  <if test="organizer4 != null and organizer4 != ''">
              ,organizer4
                 </if>
                  <if test="type4 != null and type4 != ''">
              ,type4
                 </if>
                 ,award_no4
        ) values (
        #{resume_no}    
            
            ,#{name1}
            ,#{organizer1}
            ,#{type1}
            ,#{award_no1}
            <if test="name2 != null and name2 != ''">
        ,#{name2}
        </if>
            <if test="organizer2 != null and organizer2 != ''">
        ,#{organizer2}
        </if>
        <if test="type2 != null and type2 != ''">
        ,#{type2}
        </if>       
         <choose>
          <when test="award_no2 == 0">
             ,null
          </when>
          <otherwise>
             ,#{award_no2}
          </otherwise>  
       </choose>
       
        <if test="name3 != null and name3 != ''">
        ,#{name3}
        </if>
            <if test="organizer3 != null and organizer3 != ''">
        ,#{organizer3}
        </if>
        <if test="type3 != null and type3 != ''">
        ,#{type3}
        </if>      
         <choose>
          <when test="award_no3 == 0">
             ,null
          </when>
          <otherwise>
             ,#{award_no3}
          </otherwise>  
       </choose>
       
        <if test="name4 != null and name4 != ''">
        ,#{name4}
        </if>
            <if test="organizer4 != null and organizer4 != ''">
        ,#{organizer4}
        </if>
        <if test="type4 != null and type4 != ''">
        ,#{type4}
        </if>      
         <choose>
          <when test="award_no4 == 0">
             ,null
          </when>
          <otherwise>
             ,#{award_no4}
          </otherwise>  
       </choose>
        
        )
    </insert>
    
    

    <!-- 최종학력 -->
    <insert id="insertEducation" parameterType="com.wa.erp.BoardDTO" >
        insert into education(
            resume_no
            ,school_name
            ,education
            ,enter_date
            ,graduation_date
        ) values (
            #{resume_no}    
            ,#{school_name}
            ,#{education}
            ,#{enter_date}
            ,#{graduation_date}
        )
    </insert>

    <!-- 경력 -->
    <insert id="insertCareer" parameterType="com.wa.erp.BoardDTO" >
        insert into career(
            resume_no
            ,career1
            <if test="career2 != null and career2 != ''">
              ,career2
                 </if>
                 <if test="career3 != null and career3 != ''">
              ,career3
                 </if>
                 <if test="career4 != null and career4 != ''">
              ,career4
                 </if>
                 <if test="career5 != null and career5 != ''">
              ,career5
                 </if>
         
        ) values (
          #{resume_no}    
            ,#{career1}
            <if test="career2 != null and career2 != ''">
        ,#{career2}
        </if>
             <if test="career3 != null and career3 != ''">
        ,#{career3}
        </if>
         <if test="career4 != null and career4 != ''">
        ,#{career4}
        </if> 
        <if test="career5 != null and career5 != ''">
        ,#{career5}
        </if>
        )
    </insert>

   <!-- 개인보유자격증     -->
    <insert id="insertPerson_license" parameterType="com.wa.erp.BoardDTO" >
        insert into person_license(
            resume_no
            ,license_name1
             <if test="license_name2 != null and license_name2 != ''">
              ,license_name2
                 </if>
                 <if test="license_name3 != null and license_name3 != ''">
              ,license_name3
                 </if>
                 <if test="license_name4 != null and license_name4 != ''">
              ,license_name4
                 </if>
                 <if test="license_name5 != null and license_name5 != ''">
              ,license_name5
                 </if>
        ) values (
           #{resume_no}                         
            ,#{license_name1} 
              <if test="license_name2 != null and license_name2 != ''">
        ,#{license_name2}
        </if>
             <if test="license_name3 != null and license_name3 != ''">
        ,#{license_name3}
        </if>
         <if test="license_name4 != null and license_name4 != ''">
        ,#{license_name4}
        </if> 
        <if test="license_name5 != null and license_name5 != ''">
        ,#{license_name5}
        </if>
        )
    </insert> 

    <!-- 개인보유스킬 -->
     <insert id="insertSkill_Code" parameterType="com.wa.erp.BoardDTO" >
        INSERT INTO person_skill (resume_no, skill_code)
     <foreach collection="skill_code"  item="tmp"  open=" ( " close=" ) "  separator=" union all ">
            select 
            	#{resume_no}     
                ,#{tmp}
            from dual
        </foreach>
</insert>

    
    <insert id="insertComment" parameterType="com.wa.erp.BoardDTO">
    	insert into ${table}
    	(
    	comment_no
    	,b_no
    	,p_no
    	,content
    	)
    	values(
    	(select nvl(max(comment_no),0)+1 from ${table})
    	,#{b_no}
        ,#{p_no}
        ,#{content}
    	)
    </insert>
    
    <update id="updateRec" parameterType="com.wa.erp.BoardDTO">
    	update
    		${table}
    	set
    		rec_count = rec_count+1
    	where
    		comment_no = #{comment_no}
    </update>

    <update id="downdateRec" parameterType="com.wa.erp.BoardDTO">
    	update
    		${table}
    	set
    		rec_count = rec_count-1
    	where
    		comment_no = #{comment_no}
    </update>
    
    <insert id="insertLike" parameterType="com.wa.erp.BoardDTO">
    	insert into	like_comment
    	(
    		comment_table
    		,comment_no
    		<if test="p_no != 0">
    		,p_no
    		</if>
    		,b_no
    		<if test="c_no !=0">
    		,c_no    		
    		</if>
    	)
    	values(
    		#{table}
    		,#{comment_no}
    		<if test="p_no != 0">
    		,#{p_no}
    		</if>
    		,#{b_no}
    		<if test="c_no !=0">
    		#{c_no}
    		</if>
    	)
    </insert>
    
    <delete id="deleteLike" parameterType="com.wa.erp.BoardDTO">
    	delete from like_comment
    	where
    		comment_no=#{comment_no}
    		and
    		comment_table=#{table}
    		and
    		p_no=#{p_no}
    		and
    		b_no=#{b_no}
    </delete>
    
    <insert id="insertLikeCompany" parameterType="com.wa.erp.BoardDTO">
    	insert into like_company
    	values(
    		#{c_no}
    		,#{p_no}
    	)
    </insert>
    
    <update id="updateCompanyRec" parameterType="com.wa.erp.BoardDTO">
    	update
    		company_info
    	set
    		rec_count = rec_count+1
    	where
    		c_no=#{c_no}
    </update>

    <update id="downdateCompanyRec" parameterType="com.wa.erp.BoardDTO">
    	update
    		company_info
    	set
    		rec_count = rec_count-1
    	where
    		c_no=#{c_no}
    </update>
    
    <delete id="deleteLikeCompany" parameterType="com.wa.erp.BoardDTO">
    	delete from like_company
    	where
    		c_no=#{c_no}
    		and
    		p_no=#{p_no}
    </delete>
    
    <update id="updateComment" parameterType="com.wa.erp.BoardDTO">
    	update
    		${table}
    	set
    		content = #{updateComment}
    	where
    		p_no=#{p_no}
    		and
    		b_no=#{b_no}
    		and
    		comment_no = #{comment_no}
    </update>
    
    <delete id="deleteComment" parameterType="com.wa.erp.BoardDTO">
    	delete from
    		${table}
    	where
    		p_no=#{p_no}
    		and
    		b_no=#{b_no}
    		and
    		comment_no = #{comment_no}
    </delete>
    
    <delete id="deleteLikecomment" parameterType="com.wa.erp.BoardDTO">
    	delete from
    		like_comment
    	where
    		comment_table=#{table}
    		and
    		comment_no=#{comment_no}
    		and
    		b_no=#{b_no}
    </delete>
    
    
</mapper>
 