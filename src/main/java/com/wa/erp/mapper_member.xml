<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--***************************************************-->
<!-- mapper 태그 선언하기 -->
<!-- mapper 태그 안의 namespace 값은 -->
<!-- [원하는 인터페이스 저장 패키지 경로]하고 일치해야한다. -->
<!--***************************************************-->
<mapper namespace="com.wa.erp.MemberDAO">
	
	<!--////////////// 기업 회원가입을 위한 코드 ///////////////-->
	<insert id="insertCompany" parameterType="com.wa.erp.MemberDTO" >
		insert into company_mem(
		c_no
		 ,cid
		 ,pwd
		 ,business_no
		 ,call
		 ,ceo_name
		 ,ceo_phone
		 ,name
		 ,email

		) values (
			(select nvl(max(c_no),0)+1 from company_mem)
			,#{cid}
			,#{pwd}
			,#{business_no}
			,#{call}
			,#{ceo_name}
			,#{ceo_phone}
			,#{name}
			,#{email}||#{email2}
			)
	</insert>

	<select id="getCidCnt" parameterType="com.wa.erp.MemberDTO" resultType="int">
		select 
			count(*)
		from 
			company_mem
		where
			cid = #{cid}
	</select>
	<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->

	<!--////////////// 기업 정보 등록을 위한 코드 ///////////////-->
	<insert id="insertCompanyInfo" parameterType="com.wa.erp.MemberDTO" >
		insert into company_info (
			c_no
			,url
			,volume
			,business_industry
			,birth
			,sales
			,addr
			,emp_no
			,sal_avg
		) values (
			1
			,#{url}
			,#{volume}
			,#{business_industry}
			,TO_CHAR(#{birth}, 'YYYY-MM-DD')
			,#{sales}
			,#{addr1}||#{addr2}||#{addr3}
			,#{emp_no}
			,#{sal_avg}
			)
	</insert>

	<insert id="insetCompanyWelfare" parameterType="com.wa.erp.MemberDTO">
		insert into company_welfare
		<foreach collection="welfare_code" item="tmp" open=" ( " close= " ) " separator="union">
			select
				1
				,#{tmp}
			from dual
		</foreach>
	</insert>
	
	<select id="getPidCnt" parameterType="com.wa.erp.MemberDTO" resultType="int">
		select
			count(*)
		from
			person_mem
		where
			pid = #{pid}
	</select>
	
	<insert id="insertMember" parameterType="com.wa.erp.MemberDTO" >
      insert  into person_mem
      (
	      p_no
	    ,name
	    ,pid
	    ,pwd
	    ,phone
	    ,email
	    ,field_code
	    ,is_job
	    ,nickname
	    ,addr
	    ,sex
	    ,jumin_num
      )
       values (
         (select nvl(max(p_no),0)+1 from person_mem)
         ,#{name}
         ,#{pid}
         ,#{pwd}
         ,#{phone}
         ,#{email1}||''|| #{email2}
         ,${field_code}
         ,#{is_job}
         ,#{nickname}
         ,#{addr1} ||''|| #{addr2} ||''||#{addr3}
         ,#{sex}
         ,#{jumin_num1} ||''|| #{jumin_num2}
         )

   </insert>
	
</mapper>
 